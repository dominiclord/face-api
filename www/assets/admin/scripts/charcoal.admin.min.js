/*! @locomotivemtl/charcoal-admin 20-05-2016 */
var Charcoal=Charcoal||{};Charcoal.Admin=function(){"use strict";function a(){}var b,c,d={base_url:null,admin_path:null};return a.set_data=function(a){d=$.extend(!0,d,a)},a.admin_url=function(){return d.base_url+d.admin_path+"/"},a.base_url=function(){return d.base_url},a.manager=function(){return"undefined"==typeof b&&(b=new Charcoal.Admin.ComponentManager),b},a.feedback=function(a){return"undefined"==typeof c&&(c=new Charcoal.Admin.Feedback),c.add_data(a),c},a.get_object_name=function(a){var b=a.split("/");return b=b.splice(2,b.length),b.forEach(function(a,b,c){var d=a.split("-");d.length>1&&(d.forEach(function(a,b){d[b]=a.charAt(0).toUpperCase()+a.slice(1)}),a=d.join("_")),c[b]=a.charAt(0).toUpperCase()+a.slice(1)}),a=b.join("_")},a}(),Charcoal.Admin.ComponentManager=function(){var a=this;a.components={},$(document).on("ready",function(){a.render()})},Charcoal.Admin.ComponentManager.prototype.add_property_input=function(a){this.add_component("property_inputs",a)},Charcoal.Admin.ComponentManager.prototype.add_widget=function(a){this.add_component("widgets",a)},Charcoal.Admin.ComponentManager.prototype.add_template=function(a){this.add_component("templates",a)},Charcoal.Admin.ComponentManager.prototype.add_component=function(a,b){var c=Charcoal.Admin.get_object_name(b.type);"function"==typeof Charcoal.Admin[c]?(b.ident=c,this.components[a]=this.components[a]||[],this.components[a].push(b)):console.error("Was not able to store "+c+" in "+a+" sub-array")},Charcoal.Admin.ComponentManager.prototype.render=function(){for(var a in this.components){var b=Charcoal;switch(a){case"widgets":b=Charcoal.Admin.Widget;break;case"property_inputs":b=Charcoal.Admin.Property;break;case"templates":b=Charcoal.Admin.Template}for(var c=0,d=this.components[a].length;d>c;c++){var e=this.components[a][c];if(!(e instanceof b))try{var f=new Charcoal.Admin[e.ident](e);switch(this.components[a][c]=f,a){case"widgets":Charcoal.Admin.Widget.call(f,e),f.init()}}catch(g){console.error("Was not able to instanciate "+e.ident),console.error(g)}}}},Charcoal.Admin.ComponentManager.prototype.prepare_submit=function(){return this.prepare_inputs(),this.prepare_widgets(),!0},Charcoal.Admin.ComponentManager.prototype.prepare_inputs=function(){var a="undefined"!=typeof this.components.property_inputs?this.components.property_inputs:[];if(!a.length)return!0;for(var b,c=a.length,d=0;c>d;d++)b=a[d],"function"==typeof b.validate&&b.validate();for(var e=0;c>e;e++)b=a[e],"function"==typeof b.save&&b.save();return!0},Charcoal.Admin.ComponentManager.prototype.prepare_widgets=function(){var a="undefined"!=typeof this.components.widgets?this.components.widgets:[];if(!a.length)return!0;for(var b,c=a.length,d=0;c>d;d++)b=a[d],"function"==typeof b.validate&&b.validate();for(var e=0;c>e;e++)b=a[e],"function"==typeof b.save&&b.save();return!0},Charcoal.Admin.Feedback=function(){return this.msgs=[],this.actions=[],this.context_definitions={success:{title:"SuccÃ¨s!",type:BootstrapDialog.TYPE_SUCCESS},warning:{title:"Attention!",type:BootstrapDialog.TYPE_WARNING},error:{title:"Une erreur s'est produite!",type:BootstrapDialog.TYPE_DANGER}},this},Charcoal.Admin.Feedback.prototype.add_data=function(a){return"object"!=typeof a?this:(this.msgs=this.msgs.concat(a),this)},Charcoal.Admin.Feedback.prototype.add_context=function(a){return a?"undefined"==typeof a.name||"undefined"==typeof a.title?this:(this.context_definitions[a.name]=a,this):this},Charcoal.Admin.Feedback.prototype.add_action=function(a){this.actions.push(a)},Charcoal.Admin.Feedback.prototype.call=function(){if(!this.msgs)return this;for(var a=0,b=this.msgs.length,c={};b>a;a++)"undefined"!=typeof this.msgs[a].level&&("undefined"==typeof c[this.msgs[a].level]&&(c[this.msgs[a].level]=[]),c[this.msgs[a].level].push(this.msgs[a].msg));for(var d in c)if("undefined"!=typeof this.context_definitions[d]){var e=[];if(this.actions.length)for(var f=0,g=this.actions.length;g>f;f++){var h=this.actions[f];e.push({label:h.label,action:h.callback})}BootstrapDialog.show({title:this.context_definitions[d].title,message:c[d].join("<br/>"),type:this.context_definitions[d].type,buttons:e})}return this.reset(),this},Charcoal.Admin.Feedback.prototype.reset=function(){this.msgs=[]},Charcoal.Admin.Property=function(a){return this._ident=void 0,this._val=void 0,this._type=void 0,this._input_type=void 0,"string"==typeof a.ident&&this.set_ident(a.ident),"undefined"!=typeof a.val&&this.set_val(a.val),"undefined"!=typeof a.type&&this.set_type(a.type),"undefined"!=typeof a.input_type&&this.set_input_type(a.input_type),this.data=a,this},Charcoal.Admin.Property.prototype.set_ident=function(a){this._ident=a},Charcoal.Admin.Property.prototype.set_val=function(a){this._val=a},Charcoal.Admin.Property.prototype.set_type=function(a){this._type=a},Charcoal.Admin.Property.prototype.set_input_type=function(a){this._input_type=a},Charcoal.Admin.Property.prototype.ident=function(){return this._ident},Charcoal.Admin.Property.prototype.val=function(){return this._val},Charcoal.Admin.Property.prototype.type=function(){return this._type},Charcoal.Admin.Property.prototype.input_type=function(){return this._input_type},Charcoal.Admin.Property.prototype.element=function(){if(!this._element){if(!this.data.id)return!1;this._element=$("#"+this.data.id)}return this._element},Charcoal.Admin.Property.prototype.validate=function(){},Charcoal.Admin.Property.prototype.save=function(){return this},Charcoal.Admin.Property.prototype.error=function(a){window.console.error(a)},Charcoal.Admin.Property_Input_Audio=function(a){a.input_type="charcoal/admin/property/input/audio",Charcoal.Admin.Property.call(this,a),this.text_properties={},this.recording_properties={},this.file_properties={},this.initialized_types=[],this.active_pane=a.data.active_pane||"text",this._recorder=void 0,this.init()},Charcoal.Admin.Property_Input_Audio.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Audio.prototype.constructor=Charcoal.Admin.Property_Input_Audio,Charcoal.Admin.Property_Input_Audio.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Audio.prototype.init=function(){var a=this.data;"undefined"==typeof a.id&&console.error("Missing ID"),this.text_properties.$voice_message=$(".js-text-voice-message",this.element()),this.recording_properties.audio_context=null,this.recording_properties.audio_recorder=null,this.recording_properties.animation_frame=null,this.recording_properties.analyser_context=null,this.recording_properties.canvas_width=0,this.recording_properties.canvas_height=0,this.recording_properties.recording_index=0,this.recording_properties.current_recording=null,this.recording_properties.audio_player=null,this.recording_properties.hidden_input_id=a.data.hidden_input_id,this.recording_properties.$analyser_canvas=$(".js-recording-analyser",this.element()),this.recording_properties.$waves_canvas=$(".js-recording-waves",this.element()),this.recording_properties.record_button_class="js-recording-record",this.recording_properties.$record_button=$(".js-recording-record",this.element()),this.recording_properties.stop_button_class="js-recording-stop",this.recording_properties.$stop_button=$(".js-recording-stop",this.element()),this.recording_properties.playback_button_class="js-recording-playback",this.recording_properties.$playback_button=$(".js-recording-playback",this.element()),this.recording_properties.reset_button_class="js-recording-reset",this.recording_properties.$reset_button=$(".js-recording-reset",this.element()),this.recording_properties.$timer=$(".js-recording-timer",this.element()),this.set_nav(this.active_pane).bind_nav_controls()},Charcoal.Admin.Property_Input_Audio.prototype.bind_nav_controls=function(){var a=this;this.element().on("click",".js-toggle-pane",function(){var b=$(this);a.set_nav(b.attr("data-pane"))})},Charcoal.Admin.Property_Input_Audio.prototype.set_nav=function(a){if(a){var b=$(".js-toggle-pane"),c=$(".js-pane"),d=c.filter('[data-pane="'+a+'"]');if(!d.hasClass("-active")){var e=b.filter('[data-pane="'+a+'"]');b.removeClass("-active"),e.addClass("-active"),c.removeClass("-active"),c.addClass("hidden"),d.removeClass("hidden"),d.addClass("-active"),this.prepare_pane(a)}}return this},Charcoal.Admin.Property_Input_Audio.prototype.prepare_pane=function(a){var b="init_"+a,c=Charcoal.Admin.Property_Input_Audio.prototype[b];"function"==typeof c&&this[b]()},Charcoal.Admin.Property_Input_Audio.prototype.init_text=function(){if(-1===this.initialized_types.indexOf("text")){this.initialized_types.push("text");var a=this.text_properties.$voice_message.val();a=this.text_strip_tags(a),this.text_properties.$voice_message.val(a)}},Charcoal.Admin.Property_Input_Audio.prototype.text_strip_tags=function(a,b){b=((String(b)||"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(d,"").replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})},Charcoal.Admin.Property_Input_Audio.prototype.init_recording=function(){if(-1===this.initialized_types.indexOf("recording")){var a=this;a.initialized_types.push("recording"),window.navigator.getUserMedia||(window.navigator.getUserMedia=window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia),window.navigator.cancelAnimationFrame||(window.navigator.cancelAnimationFrame=window.navigator.webkitCancelAnimationFrame||window.navigator.mozCancelAnimationFrame),window.navigator.requestAnimationFrame||(window.navigator.requestAnimationFrame=window.navigator.webkitRequestAnimationFrame||window.navigator.mozRequestAnimationFrame),window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext),window.navigator.getUserMedia({audio:{mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1},optional:[]}},function(b){a.recording_bind_events(),a.recording_got_stream(b)},function(a){window.alert("Error getting audio. Try plugging in a microphone"),window.console.log(a)})}},Charcoal.Admin.Property_Input_Audio.prototype.recording_bind_events=function(){var a=this;a.element().on("click","."+a.recording_properties.record_button_class,function(){a.recording_manage_recorder()}),a.element().on("click","."+a.recording_properties.stop_button_class,function(){a.recording_manage_recorder("stop")}),a.element().on("click","."+a.recording_properties.playback_button_class,function(){0!==a.recording_properties.recording_index&&null!==a.recording_properties.audio_player&&a.recording_toggle_playback()}),a.element().on("click","."+a.recording_properties.reset_button_class,function(){a.recording_reset_audio()})},Charcoal.Admin.Property_Input_Audio.prototype.recording_got_stream=function(a){var b=this;b.recording_properties.audio_context=new window.AudioContext,b.recording_properties.audio_player=new window.Audio_Player({on_ended:function(){b.recording_manage_button_states("pause_playback")},on_timeupdate:function(a){b.recording_render_timer(a)},on_loadedmetadata:function(a){b.recording_render_timer(a)}});var c=b.recording_properties.audio_context.createGain(),d=b.recording_properties.audio_context.createMediaStreamSource(a),e=null;d.connect(c),window.analyserNode=b.recording_properties.audio_context.createAnalyser(),window.analyserNode.fftSize=2048,c.connect(window.analyserNode),b.recording_properties.audio_recorder=new window.Recorder(c),e=b.recording_properties.audio_context.createGain(),e.gain.value=0,c.connect(e),e.connect(b.recording_properties.audio_context.destination),b.recording_update_analysers()},Charcoal.Admin.Property_Input_Audio.prototype.recording_manage_button_states=function(a){switch(a){case"start_recording":this.recording_properties.$record_button.addClass("is-recording"),this.recording_properties.$stop_button.prop("disabled",!1),this.recording_properties.$playback_button.prop("disabled",!0),this.recording_properties.$reset_button.prop("disabled",!1);break;case"pause_recording":this.recording_properties.$record_button.removeClass("is-recording"),this.recording_properties.$stop_button.prop("disabled",!1),this.recording_properties.$playback_button.prop("disabled",!0),this.recording_properties.$reset_button.prop("disabled",!1);break;case"stop_recording":this.recording_properties.$record_button.removeClass("is-recording"),this.recording_properties.$stop_button.prop("disabled",!0),this.recording_properties.$playback_button.prop("disabled",!1),this.recording_properties.$reset_button.prop("disabled",!1);break;case"start_playback":this.recording_properties.$playback_button.addClass("is-playing");break;case"pause_playback":this.recording_properties.$playback_button.removeClass("is-playing");break;case"reset":this.recording_properties.$record_button.removeClass("is-recording"),this.recording_properties.$stop_button.prop("disabled",!0),this.recording_properties.$playback_button.prop("disabled",!0).removeClass("is-playing"),this.recording_properties.$reset_button.prop("disabled",!0)}},Charcoal.Admin.Property_Input_Audio.prototype.recording_render_timer=function(a){var b="";if(a){var c=0,d=0,e=a.duration-a.currentTime;c=Math.floor(e/60),d=Math.round(e)%60,b+=(10>c?"0":"")+String(c)+":",b+=(10>d?"0":"")+String(d)}else b="00:00";this.recording_properties.$timer.text(b)},Charcoal.Admin.Property_Input_Audio.prototype.recording_manage_recorder=function(a){var b=this;if("stop"===a)return b.recording_properties.audio_recorder.stop(),b.recording_properties.audio_recorder.get_buffers(function(a){b.recording_got_buffers(a),b.recording_properties.audio_recorder.clear(),b.recording_display_canvas("waves")}),void b.recording_manage_button_states("stop_recording");if(b.recording_properties.audio_recorder.is_recording())b.recording_properties.audio_recorder.stop(),b.recording_manage_button_states("pause_recording");else{if(!b.recording_properties.audio_recorder)return;b.recording_properties.audio_recorder.record(),b.recording_manage_button_states("start_recording"),b.recording_display_canvas("analyser")}},Charcoal.Admin.Property_Input_Audio.prototype.recording_toggle_playback=function(){if(this.recording_properties.audio_player.is_playing())this.recording_properties.audio_player.pause(),this.recording_manage_button_states("pause_playback");else{if(!this.recording_properties.audio_player)return;this.recording_properties.audio_player.play(),this.recording_manage_button_states("start_playback")}},Charcoal.Admin.Property_Input_Audio.prototype.recording_reset_audio=function(){var a=this.recording_properties.$analyser_canvas[0],b=a.getContext("2d");b.clearRect(0,0,a.canvas_width,a.canvas_height);var c=this.recording_properties.$waves_canvas[0],d=c.getContext("2d");d.clearRect(0,0,c.canvas_width,c.canvas_height),this.recording_properties.audio_player.load(),this.recording_properties.audio_player.src(""),this.recording_properties.audio_recorder.stop(),this.recording_properties.audio_recorder.clear(),this.recording_manage_button_states("reset"),this.recording_display_canvas("analyser"),this.recording_render_timer();var e=document.getElementById(this.recording_properties.hidden_input_id);e&&(e.value="")},Charcoal.Admin.Property_Input_Audio.prototype.recording_got_buffers=function(a){var b=this.recording_properties.$waves_canvas[0],c=this;c.recording_draw_buffer(b.width,b.height,b.getContext("2d"),a[0]),c.recording_properties.audio_recorder.export_wav(function(a){c.recording_done_encoding(a)})},Charcoal.Admin.Property_Input_Audio.prototype.recording_draw_buffer=function(a,b,c,d){var e=Math.ceil(d.length/a),f=b/2;c.fillStyle="#DDDDDD",c.clearRect(0,0,a,b);for(var g=0;a>g;g++){for(var h=1,i=-1,j=0;e>j;j++){var k=d[g*e+j];h>k&&(h=k),k>i&&(i=k)}c.fillRect(g,(1+h)*f,1,Math.max(1,(i-h)*f))}},Charcoal.Admin.Property_Input_Audio.prototype.recording_done_encoding=function(a){var b=new window.FileReader,c=null,d=this;b.readAsDataURL(a),b.onloadend=function(){c=b.result,d.recording_properties.recording_index++,d.recording_manage_audio_data(c)}},Charcoal.Admin.Property_Input_Audio.prototype.recording_manage_audio_data=function(a){if(a){var b=document.getElementById(this.recording_properties.hidden_input_id);b&&(b.value=a),this.recording_properties.audio_player.src(a),this.recording_properties.audio_player.load()}},Charcoal.Admin.Property_Input_Audio.prototype.recording_display_canvas=function(a){switch(a){case"waves":this.recording_properties.$analyser_canvas.addClass("hidden"),this.recording_properties.$waves_canvas.removeClass("hidden");break;default:this.recording_properties.$analyser_canvas.removeClass("hidden"),this.recording_properties.$waves_canvas.addClass("hidden")}},Charcoal.Admin.Property_Input_Audio.prototype.recording_cancel_analyser_update=function(){window.cancelAnimationFrame(this.recording_properties.animation_frame),this.recording_properties.animation_frame=null},Charcoal.Admin.Property_Input_Audio.prototype.recording_update_analysers=function(){this.recording_properties.analyser_context||(this.recording_properties.analyser_context=this.recording_properties.$analyser_canvas[0].getContext("2d"));var a=this,b=a.recording_properties.analyser_context,c=a.recording_properties.$analyser_canvas[0];if(a.recording_properties.canvas_width=c.width,a.recording_properties.canvas_height=c.height,b.lineCap="round",a.recording_properties.audio_recorder.is_recording()){var d=5,e=2,f=Math.round(a.recording_properties.canvas_width/d),g=new window.Uint8Array(window.analyserNode.frequencyBinCount),h=0;window.analyserNode.getByteFrequencyData(g),h=window.analyserNode.frequencyBinCount/f,b.clearRect(0,0,a.recording_properties.canvas_width,a.recording_properties.canvas_height);for(var i=0;f>i;++i){for(var j=0,k=Math.floor(i*h),l=0;h>l;l++)j+=g[k+l];j/=h,b.fillStyle=b.fillStyle="#DDDDDD",b.fillRect(i*d,a.recording_properties.canvas_height,e,-j)}}else b.clearRect(0,0,a.recording_properties.canvas_width,a.recording_properties.canvas_height);a.recording_properties.animation_frame=window.requestAnimationFrame(function(){a.recording_update_analysers()})},function(a){var b="../../assets/admin/scripts/vendors/recorderWorker.js",c=function(c,d){var e,f=d||{},g=f.buffer_length||4096,h=new a.Worker(f.workerPath||b),i=!1;this.context=c.context,this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(g,2,2):this.node=this.context.createJavaScriptNode(g,2,2),h.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}}),this.node.onaudioprocess=function(a){i&&h.postMessage({command:"record",buffer:[a.inputBuffer.getChannelData(0),a.inputBuffer.getChannelData(1)]})},this.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&(f[b]=a[b])},this.record=function(){i=!0},this.stop=function(){i=!1},this.clear=function(){h.postMessage({command:"clear"})},this.get_buffers=function(a){e=a||f.callback,h.postMessage({command:"getBuffers"})},this.export_wav=function(a,b){if(e=a||f.callback,b=b||f.type||"audio/wav",!e)throw new Error("Callback not set");h.postMessage({command:"exportWAV",type:b})},this.is_recording=function(){return i},h.onmessage=function(a){var b=a.data;e(b)},c.connect(this.node),this.node.connect(this.context.destination)};a.Recorder=c}(window),function(a){var b=function(b){this.callbacks={on_ended:b.on_ended||function(){},on_pause:b.on_pause||function(){},on_playing:b.on_playing||function(){},on_timeupdate:b.on_timeupdate||function(){},on_loadedmetadata:b.on_loadedmetadata||function(){}},this._element=new a.Audio,this.play=function(){this.element().play()},this.pause=function(){this.element().pause()},this.load=function(){this.element().load()},this.src=function(a){this.element().src=a},this.is_playing=function(){return!this.element().paused&&!this.element().ended&&this.element().currentTime>0},this.element=function(){return this._element};var c=this;c.element().addEventListener("ended",function(){c.callbacks.on_ended()}),c.element().addEventListener("pause",function(){c.callbacks.on_pause()}),c.element().addEventListener("playing",function(){c.callbacks.on_playing()}),c.element().addEventListener("timeupdate",function(){c.callbacks.on_timeupdate(c.element())}),c.element().addEventListener("loadedmetadata",function(){c.callbacks.on_loadedmetadata(c.element())})};a.Audio_Player=b}(window),Charcoal.Admin.Property_Input_Colorpicker=function(a){this.input_type="charcoal/admin/property/input/colorpicker",this.input_id=null,this.colorpicker_options=null,this.set_properties(a),this.create_colorpicker()},Charcoal.Admin.Property_Input_Colorpicker.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Colorpicker.prototype.constructor=Charcoal.Admin.Property_Input_Colorpicker,Charcoal.Admin.Property_Input_Colorpicker.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Colorpicker.prototype.set_properties=function(a){this.input_id=a.id||this.input_id,this.colorpicker_options=a.data.colorpicker_options||this.colorpicker_options;var b={format:"hex",letterCase:"uppercase",opacity:!1,theme:"bootstrap"};return this.colorpicker_options=$.extend({},b,this.colorpicker_options),this},Charcoal.Admin.Property_Input_Colorpicker.prototype.create_colorpicker=function(){$("#"+this.input_id).minicolors(this.colorpicker_options)},Charcoal.Admin.Property_Input_DateTimePicker=function(a){this.input_type="charcoal/admin/property/input/datetimepicker",this.input_id=null,this.datetimepicker_selector=null,this.datetimepicker_options=null,this.set_properties(a).create_datetimepicker()},Charcoal.Admin.Property_Input_DateTimePicker.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_DateTimePicker.prototype.constructor=Charcoal.Admin.Property_Input_DateTimePicker,Charcoal.Admin.Property_Input_DateTimePicker.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_DateTimePicker.prototype.set_properties=function(a){this.input_id=a.id||this.input_id,this.datetimepicker_selector=a.data.datetimepicker_selector||this.datetimepicker_selector,this.datetimepicker_options=a.data.datetimepicker_options||this.datetimepicker_options;var b={};return this.datetimepicker_options=$.extend({},b,this.datetimepicker_options),this},Charcoal.Admin.Property_Input_DateTimePicker.prototype.create_datetimepicker=function(){$(this.datetimepicker_selector).datetimepicker(this.datetimepicker_options)},Charcoal.Admin.Property_Input_Map_Widget=function(a){a.input_type="charcoal/admin/property/input/map-widget",Charcoal.Admin.Property.call(this,a);var b=this;this._controller=void 0,this._object_inc=0,"undefined"==typeof google?(window._tmp_google_onload_function=function(){b.init()},$.getScript("https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&language=fr&callback=_tmp_google_onload_function",function(){})):b.init()},Charcoal.Admin.Property_Input_Map_Widget.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Map_Widget.prototype.constructor=Charcoal.Admin.Property_Input_Map_Widget,Charcoal.Admin.Property_Input_Map_Widget.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Map_Widget.prototype.init=function(){if("undefined"!=typeof window._tmp_google_onload_function&&delete window._tmp_google_onload_function,"undefined"==typeof BB||"undefined"==typeof google)return console.error("Plugins not loaded"),!1;var a=this.data;"undefined"==typeof a.id&&console.error("Missing ID");var b={strokeColor:"#000000",strokeOpacity:.8,strokeWeight:3,fillColor:"#ffffff",fillOpacity:.35,hover:{strokeColor:"#000000",strokeOpacity:1,strokeWeight:2,fillColor:"#ffffff",fillOpacity:.5},focused:{fillOpacity:.8}},c={default_styles:b,use_clusterer:!1,map:{center:{x:45.3712923,y:-73.9820994},zoom:14,mapType:"roadmap",coordsType:"inpage",map_mode:"default"}};c=$.extend(!0,c,a.data);var d=this.element().find("input[type=hidden]").val();if(d){var e=JSON.parse(d),f={},g=0;for(var h in e)g++,f[h]=e[h],f[h].styles=$.extend(e[h].styles,b);f&&(c.places=f),g&&(this._object_inc=g)}this._controller=new window.BB.gmap.controller(this.element().find(".js-map-maker-map").get(0),c),this.controller().init().ready(function(a){a.fit_bounds(),a.remove_focus()}),this.controller().set_styles([{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]}]),this.controller().remove_focus(),this.controls()},Charcoal.Admin.Property_Input_Map_Widget.prototype.controller=function(){return this._controller},Charcoal.Admin.Property_Input_Map_Widget.prototype.object_index=function(){return++this._object_inc},Charcoal.Admin.Property_Input_Map_Widget.prototype.controls=function(){var a=this,b="object";this.element().on("click",".js-add-marker",function(c){c.preventDefault();for(var d=b+a.object_index();a.controller().get_place(d);)d=b+a.object_index();a.controller().create_new("marker",d)}),this.element().on("click",".js-display-marker-toolbox",function(b){return b.preventDefault(),$(this).hasClass("-active")?($(this).removeClass("-active"),a.hide_marker_toolbar(),!1):($(this).siblings(".-active").removeClass("-active"),$(this).addClass("-active"),void a.display_marker_toolbar())}),this.element().on("click",".js-add-line",function(c){if(c.preventDefault(),$(this).hasClass("-active"))return $(this).removeClass("-active"),!1;$(this).siblings(".-active").removeClass("-active"),$(this).addClass("-active");for(var d=b+a.object_index();a.controller().get_place(d);)d=b+a.object_index();a.controller().create_new("line",d)}),this.element().on("click",".js-add-polygon",function(c){if(c.preventDefault(),$(this).hasClass("-active"))return $(this).removeClass("-active"),!1;$(this).siblings(".-active").removeClass("-active"),$(this).addClass("-active");for(var d=b+a.object_index();a.controller().get_place(d);)d=b+a.object_index();a.controller().create_new("polygon",d)}),this.element().on("click",".js-add_place_by_address",function(b){b.preventDefault();var c=a.element().find(".js-address").val();return c?void a.controller().add_place_by_address("object"+a.object_index(),c,{type:"marker",draggable:!0,editable:!0,loaded_callback:function(b){a.controller().map().setCenter(b.object().getPosition())}}):!1}),this.element().on("click",".js-reset",function(b){b.preventDefault(),a.controller().reset()}),a.controller().on("focus",function(b){var c=b.data("type");switch(a.element().find(".js-add-polygon").removeClass("-active"),a.element().find(".js-display-marker-toolbox").removeClass("-active"),a.element().find(".js-add-line").removeClass("-active"),c){case"marker":a.element().find(".js-display-marker-toolbox").addClass("-active");break;case"polygon":a.element().find(".js-add-polygon").addClass("-active");break;case"line":a.element().find(".js-add-line").addClass("-active")}})},Charcoal.Admin.Property_Input_Map_Widget.prototype.display_marker_toolbar=function(){$(".c-map-maker ").addClass("maker_header-open")},Charcoal.Admin.Property_Input_Map_Widget.prototype.hide_marker_toolbar=function(){$(".c-map-maker ").removeClass("maker_header-open")},Charcoal.Admin.Property_Input_Map_Widget.prototype.save=function(){var a=this.controller()["export"](),b="object"==typeof a.places?a.places:{};return this.element().find("input[type=hidden]").val(JSON.stringify(b)),this},Charcoal.Admin.Property_Input_Switch=function(a){this.input_type="charcoal/admin/property/input/switch",this.input_id=null,this.input_selector=null,this.switch_selector=null,this.set_properties(a).create_switch()},Charcoal.Admin.Property_Input_Switch.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Switch.prototype.constructor=Charcoal.Admin.Property_Input_Switch,Charcoal.Admin.Property_Input_Switch.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Switch.prototype.set_properties=function(a){return this.input_id=a.id||this.input_id,this.input_selector=a.data.input_selector||this.input_selector,this.switch_selector=a.data.switch_selector||this.switch_selector,this},Charcoal.Admin.Property_Input_Switch.prototype.create_switch=function(){var a=this;$(a.switch_selector).bootstrapSwitch({onSwitchChange:function(b,c){$(a.input_selector).val(c?1:0)}})},Charcoal.Admin.Property_Input_Text=function(a){return this.input_type="charcoal/admin/property/input/text",this.opts=a,this.data=a.data,this.set_input_id(this.opts.id),this.set_data(this.data),this.init(),this},Charcoal.Admin.Property_Input_Text.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Text.prototype.constructor=Charcoal.Admin.Property_Input_Text,Charcoal.Admin.Property_Input_Text.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Text.prototype.set_data=function(a){return this.set_input_name(a.input_name),this.set_input_val(a.input_val),this.set_readonly(a.readonly),this.set_required(a.required),this.set_min_length(a.min_length),this.set_max_length(a.max_length),this.set_size(a.size),this.set_multiple(a.multiple),this.set_multiple_separator(a.multiple_separator),this},Charcoal.Admin.Property_Input_Text.prototype.init=function(){return this.input_id?(this.$input=$("#"+this.input_id),void(this.multiple&&this.init_multiple())):this},Charcoal.Admin.Property_Input_Text.prototype.init_multiple=function(){return this.chars_new=[13],this.chars_remove=[8,46],this.char_next=[40],this.char_prev=[38],this.$container=this.$input.parent("div"),this.bind_keyboard_events(this.$input),this.split_val(this.$input),this},Charcoal.Admin.Property_Input_Text.prototype.split_val=function(a){var b=this.multiple_separator;a=a||this.$input;var c=a.val(),d=c.split(b),e=0,f=d.length;if(1===f)return!1;for(;f>e;e++)0===e?a.val(d[e]):a=this.insert_item(a,d[e]);return this},Charcoal.Admin.Property_Input_Text.prototype.bind_keyboard_events=function(a){var b=this,c=this.chars_new,d=this.chars_remove,e=this.char_next,f=this.char_prev;a.on("keydown",function(a){var g=a.keyCode;c.indexOf(g)>-1&&(a.preventDefault(),b.insert_item($(this))),d.indexOf(g)>-1&&""===$(this).val()&&(a.preventDefault(),b.remove_item($(this))),f.indexOf(g)>-1&&(a.preventDefault(),$(this).prev("input").focus()),e.indexOf(g)>-1&&(a.preventDefault(),$(this).next("input").focus())}),a.on("keyup",function(){b.split_val($(this))})},Charcoal.Admin.Property_Input_Text.prototype.insert_item=function(a,b){var c=this.input_clone(b);return c.insertAfter(a),this.bind_keyboard_events(c),c.focus(),c},Charcoal.Admin.Property_Input_Text.prototype.add_item=function(a){var b=this.input_clone(a);return this.$container.append(b),this.bind_keyboard_events(b),b.focus(),b},Charcoal.Admin.Property_Input_Text.prototype.remove_item=function(a){var b=a.prev("input"),c=a.next("input");return b.length||c.length?(b.length?b.focus():c.length&&c.focus(),this.remove_item_listeners(a),a.remove(),this):!1},Charcoal.Admin.Property_Input_Text.prototype.remove_item_listeners=function(a){return a.off("keydown"),a.off("keyup"),this},Charcoal.Admin.Property_Input_Text.prototype.input_clone=function(a){var b=this.$input,c=b.attr("class"),d=this.min_length,e=this.max_length,f=this.required,g=this.readonly,h=this.input_name,i=$('<input type="text" />');return c&&i.attr("class",c),d&&i.attr("minlength",d),e&&i.attr("maxlength",e),f&&i.attr("required","required"),g&&i.attr("read_only","read_only"),a&&i.val(a),i.attr("name",h),i},Charcoal.Admin.Property_Input_Text.prototype.set_input_id=function(a){return this.input_id=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_input_name=function(a){return this.input_name=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_input_val=function(a){return this.input_val=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_readonly=function(a){return a||(a=!1),this.readonly=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_required=function(a){return a||(a=!1),this.required=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_min_length=function(a){return a||(a=0),this.min_length=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_max_length=function(a){
return a||(a=0),this.max_length=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_size=function(a){return a||(a=0),this.size=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_multiple=function(a){return a||(a=!1),this.multiple=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_multiple_separator=function(a){return a||(a=","),this.multiple_separator=a,this},Charcoal.Admin.Property_Input_Tinymce=function(a){this.input_type="charcoal/admin/property/input/tinymce",this.input_id=null,this.editor_options=null,this.set_properties(a).create_tinymce()},Charcoal.Admin.Property_Input_Tinymce.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Tinymce.prototype.constructor=Charcoal.Admin.Property_Input_Tinymce,Charcoal.Admin.Property_Input_Tinymce.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Tinymce.prototype.set_properties=function(a){this.input_id=a.id||this.input_id,this.editor_options=a.editor_options||a.data.editor_options||this.editor_options;var b={plugins:["advlist","anchor","autolink","autoresize","charmap","code","colorpicker","contextmenu","fullscreen","hr","image","link","lists","media","nonbreaking","noneditable","paste","print","searchreplace","tabfocus","table","visualblocks","visualchars","wordcount"],toolbar:"undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image anchor",browser_spellcheck:!0,end_container_on_empty_block:!0,entity_encoding:"raw",allow_conditional_comments:!0,convert_fonts_to_spans:!0,forced_root_block:"p",allow_script_urls:!1,document_base_url:"{{base_url}}",relative_urls:!0,remove_script_host:!1,autoresize_min_height:"150px",autoresize_max_height:"400px",contextmenu:"link image inserttable | cell row column deletetable",image_advtab:!0,importcss_append:!0,media_alt_source:!1,media_poster:!0,media_dimensions:!0,nonbreaking_force_tab:!1,paste_data_images:!0,paste_as_text:!0,paste_merge_formats:!0,table_grid:!0,table_tab_navigation:!0,visualblocks_default_state:!1};return this.editor_options=$.extend({},b,this.editor_options),this.editor_options.selector="#"+this.input_id,this.editor_options.setup=function(a){a.on("change",function(){window.tinymce.triggerSave()})},this},Charcoal.Admin.Property_Input_Tinymce.prototype.create_tinymce=function(){var a=this;return"object"!=typeof window.tinyMCE?(this.load_assets(function(){a.create_tinymce()}),this):void window.tinyMCE.init(this.editor_options)},Charcoal.Admin.Property_Input_Tinymce.prototype.load_assets=function(a){var b=Charcoal.Admin.base_url()+"assets/admin/scripts/vendors/tinymce/tinymce.min.js";return $.getScript(b,function(){"function"==typeof a&&a()}),this},Charcoal.Admin.Property_Input_Tinymce.prototype.set_editor=function(a){return this.editor=a,this},Charcoal.Admin.Property_Input_Tinymce.prototype.editor=function(){return this.editor},Charcoal.Admin.Template=function(a){window.alert("Template "+a)},Charcoal.Admin.Template_Login=function(a){this.template_type="charcoal/admin/template/login",this.init(a)},Charcoal.Admin.Template_Login.prototype=Object.create(Charcoal.Admin.Template.prototype),Charcoal.Admin.Template_Login.prototype.constructor=Charcoal.Admin.Template_Login,Charcoal.Admin.Template_Login.prototype.parent=Charcoal.Admin.Template.prototype,Charcoal.Admin.Template_Login.prototype.init=function(a){window.console.debug(a),this.bind_events()},Charcoal.Admin.Template_Login.prototype.bind_events=function(){$(".js-login-submit").on("click",function(a){a.preventDefault();var b=$(this).parents("form"),c=Charcoal.Admin.admin_url()+"login",d=b.serialize();$.post(c,d,function(a){window.console.debug(a),a.success?window.location.href=a.next_url:BootstrapDialog.show({title:"Login error",message:"Authentication failed. Please try again.",type:BootstrapDialog.TYPE_DANGER})}).fail(function(){BootstrapDialog.show({title:"Login error",message:"Authentication failed. Please try again.",type:BootstrapDialog.TYPE_DANGER})})})},Charcoal.Admin.Template_MenuHeader=function(){$(".js-toggle-class").click(function(a){a.preventDefault();var b=$(this),c=b.data("class"),d=b.data("target");$(d).toggleClass(c)}),$(document).on("click",".js-accordion-header",function(a){a.preventDefault();var b=$(this);b.toggleClass("is-open").siblings(".js-accordion-content").stop().slideToggle()})},Charcoal.Admin.Widget=function(a){return this._element=void 0,this._id=void 0,this._type=void 0,this._opts=void 0,a?("string"==typeof a.id&&(this.set_element($("#"+a.id)),this.set_id(a.id)),"string"==typeof a.type&&(this.set_type(a.type),this.widget_type=a.type),this.set_opts(a),this):this},Charcoal.Admin.Widget.prototype.set_opts=function(a){return this._opts=a,this},Charcoal.Admin.Widget.prototype.opts=function(a){return"string"==typeof a?"undefined"==typeof this._opts[a]?!1:this._opts[a]:this._opts},Charcoal.Admin.Widget.prototype.init=function(){return this},Charcoal.Admin.Widget.prototype.set_id=function(a){this._id=a},Charcoal.Admin.Widget.prototype.id=function(){return this._id},Charcoal.Admin.Widget.prototype.set_type=function(a){this._type=a},Charcoal.Admin.Widget.prototype.type=function(){return this._type},Charcoal.Admin.Widget.prototype.set_element=function(a){return this._element=a,this},Charcoal.Admin.Widget.prototype.widget_options=function(){return this.opts()},Charcoal.Admin.Widget.prototype.element=function(){return this._element},Charcoal.Admin.Widget.prototype.widget_options=function(){return this.opts()},Charcoal.Admin.Widget.prototype.widget_type=function(){return this.type()},Charcoal.Admin.Widget.prototype.save=function(){return!0},Charcoal.Admin.Widget.prototype.anim_out=function(a){return"function"!=typeof a&&(a=function(){}),this.element().fadeOut(400,a),this},Charcoal.Admin.Widget.prototype.reload=function(a){var b=this,c=Charcoal.Admin.admin_url()+"widget/load",d={widget_type:b.type(),widget_options:b.widget_options()};$.post(c,d,function(c){"string"==typeof c.widget_id&&(b.set_id(c.widget_id),b.anim_out(function(){b.element().replaceWith(c.widget_html),b.set_element($("#"+b.id())),b.element().hide().fadeIn(),b.init()})),"function"==typeof a&&a(c)})},Charcoal.Admin.Widget.prototype.dialog=function(a,b){var c=a.title||"",d=a.type||BootstrapDialog.TYPE_DEFAULT;BootstrapDialog.show({title:c,type:d,nl2br:!1,message:function(c){var d=Charcoal.Admin.admin_url()+"widget/load",e=a,f=$("<div>Loading...</div>");return $.ajax({method:"POST",url:d,data:e}).done(function(a){a.success?(c.setMessage(a.widget_html),"function"==typeof b&&b(a)):(c.setType(BootstrapDialog.TYPE_DANGER),c.setMessage("Error"))}),f}})},Charcoal.Admin.Widget_Add_Attachment=function(){return this},Charcoal.Admin.Widget_Add_Attachment.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Add_Attachment.prototype.constructor=Charcoal.Admin.Widget_Add_Attachment,Charcoal.Admin.Widget_Add_Attachment.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Add_Attachment.prototype.init=function(){if("function"!=typeof $.fn.sortable){var a=this;return this.load_assets(function(){a.init()}),this}return this.element().find(".js-attachment-sortable").find(".js-grid-container").sortable({}).disableSelection(),this.listeners(),this},Charcoal.Admin.Widget_Add_Attachment.prototype.load_assets=function(a){return $.getScript("https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js",function(){"function"==typeof a&&a()}),this},Charcoal.Admin.Widget_Add_Attachment.prototype.listeners=function(){var a=this;this.element().off("click"),this.element().on("click",".js-add-attachment",function(b){b.preventDefault();var c=$(this).data("type");return c?void a.create_attachment(c):!1})},Charcoal.Admin.Widget_Add_Attachment.prototype.select_attachment=function(a){return a.data("id")&&a.data("type")?void 0:this},Charcoal.Admin.Widget_Add_Attachment.prototype.create_attachment=function(a){var b=this,c={widget_type:"charcoal/admin/widget/quickForm",form_ident:"quick",widget_options:{obj_type:a,obj_id:0}};this.dialog(c,function(c){if(c.success){if(!c.widget_id)return!1;Charcoal.Admin.manager().add_widget({id:c.widget_id,type:"charcoal/admin/widget/quick-form",data:{obj_type:a,obj_id:0},save_callback:function(a){console.log(a),a.success&&(b.add(a.obj),b.save(function(){b.reload()}),BootstrapDialog.closeAll())}}),Charcoal.Admin.manager().render()}})},Charcoal.Admin.Widget_Add_Attachment.prototype.add=function(a){if(!a)return!1;var b=a.type;switch(b){case"charcoal/cms/attachment/image":this.add_image(a);break;case"charcoal/cms/attachment/video":this.add_video(a)}},Charcoal.Admin.Widget_Add_Attachment.prototype.add_image=function(a){var b=this.element().find(".js-templates").find(".js-template-image").clone();return b.find(".js-attachment").data("id",a.id).data("type",a.type),b.find("img").attr("src",Charcoal.Admin.base_url()+a.file),this.element().find(".js-attachment-sortable").find(".js-grid-container").append(b),this},Charcoal.Admin.Widget_Add_Attachment.prototype.add_video=function(a){console.log(a);var b=this.element().find(".js-templates").find(".js-template-video").clone();return b.find(".js-attachment").data("id",a.id).data("type",a.type).append($(a.embed)),this.element().find(".js-attachment-sortable").find(".js-grid-container").append(b),this},Charcoal.Admin.Widget_Add_Attachment.prototype.save=function(a){var b=this,c=b.opts(),d={obj_type:c.data.obj_type,obj_id:c.data.obj_id,attachments:[]};this.element().find(".js-attachment-container").find(".js-attachment").each(function(a){var b=$(this),c=b.data("id"),e=b.data("type");d.attachments.push({attachment_id:c,attachment_type:e,position:a})}),$.post("join",d,function(){"function"==typeof a&&a()})},Charcoal.Admin.Widget_Add_Attachment.prototype.widget_options=function(){return this.opts("widget_options")},Charcoal.Admin.Widget_Attachment=function(){return this},Charcoal.Admin.Widget_Attachment.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Attachment.prototype.constructor=Charcoal.Admin.Widget_Attachment,Charcoal.Admin.Widget_Attachment.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Attachment.prototype.init=function(){if("function"!=typeof $.fn.sortable){var a=this;return this.load_assets(function(){a.init()}),this}return this.element().find(".js-attachment-sortable").find(".js-grid-container").sortable({connectWith:".js-grid-container"}).disableSelection(),this.listeners(),this},Charcoal.Admin.Widget_Attachment.prototype.load_assets=function(a){return $.getScript("https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js",function(){"function"==typeof a&&a()}),this},Charcoal.Admin.Widget_Attachment.prototype.listeners=function(){var a=this;this.element().off("click"),this.element().on("click",".js-add-attachment",function(b){b.preventDefault();var c=$(this).data("type");return c?void a.create_attachment(c):!1})},Charcoal.Admin.Widget_Attachment.prototype.select_attachment=function(a){return a.data("id")&&a.data("type")?void 0:this},Charcoal.Admin.Widget_Attachment.prototype.create_attachment=function(a){var b=this,c={widget_type:"charcoal/admin/widget/quickForm",form_ident:"quick",widget_options:{obj_type:a,obj_id:0}};this.dialog(c,function(c){if(c.success){if(!c.widget_id)return!1;Charcoal.Admin.manager().add_widget({id:c.widget_id,type:"charcoal/admin/widget/quick-form",data:{obj_type:a,obj_id:0},save_callback:function(a){a.success&&(BootstrapDialog.closeAll(),b.reload())}}),Charcoal.Admin.manager().render()}})},Charcoal.Admin.Widget_Attachment.prototype.save=function(){var a=this,b=a.opts(),c={obj_type:b.data.obj_type,obj_id:b.data.obj_id,attachments:[]};this.element().find(".js-attachment-container").find(".js-attachment").each(function(a){var b=$(this),d=b.data("id"),e=b.data("type");c.attachments.push({attachment_id:d,attachment_type:e,position:a})}),$.post("join",c,function(){})},Charcoal.Admin.Widget_Attachment.prototype.widget_options=function(){return this.opts("widget_options")},Charcoal.Admin.Widget_Form=function(a){this.widget_type="charcoal/admin/widget/form",this.widget_id=null,this.obj_type=null,this.obj_id=null,this.form_selector=null,this.set_properties(a).bind_events()},Charcoal.Admin.Widget_Form.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Form.prototype.constructor=Charcoal.Admin.Widget_Form,Charcoal.Admin.Widget_Form.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Form.prototype.set_properties=function(a){return this.widget_id=a.id||this.widget_id,this.obj_type=a.data.obj_type||this.obj_type,this.obj_id=a.data.obj_id||this.obj_id,this.form_selector=a.data.form_selector||this.form_selector,this},Charcoal.Admin.Widget_Form.prototype.bind_events=function(){var a=this;$(a.form_selector).on("submit",function(b){b.preventDefault(),a.submit_form(this)}),$(".js-obj-delete").on("click",function(b){b.preventDefault(),a.delete_object(this)}),$(".js-reset-form").on("click",function(b){b.preventDefault(),$(a.form_selector)[0].reset()}),$(".js-lang-switch button").on("click",function(b){b.preventDefault();var c=$(this),d=c.attr("data-lang-switch");a.switch_language(d)})},Charcoal.Admin.Widget_Form.prototype.submit_form=function(a){Charcoal.Admin.manager().prepare_submit();var b,c,d=this,e=new FormData(a);d.obj_id?(b=Charcoal.Admin.admin_url()+"object/update",c=!1):(b=Charcoal.Admin.admin_url()+"object/save",c=!0),$.ajax({url:b,type:"POST",processData:!1,contentType:!1,data:e,success:function(a){a.success?(Charcoal.Admin.feedback().add_data(a.feedbacks),a.next_url&&Charcoal.Admin.feedback().add_action({label:"Continuer",callback:function(){window.location.href=Charcoal.Admin.admin_url()+a.next_url}}),c?a.next_url?window.location.href=Charcoal.Admin.admin_url()+a.next_url:window.location.href=Charcoal.Admin.admin_url()+"object/edit?obj_type="+d.obj_type+"&obj_id="+a.obj_id:Charcoal.Admin.feedback().call()):(Charcoal.Admin.feedback().add_data([{level:"An error occurred and the object could not be saved.",msg:"error"}]),Charcoal.Admin.feedback().call())},error:function(){Charcoal.Admin.feedback().add_data([{level:"An error occurred and the object could not be saved.",msg:"error"}]),Charcoal.Admin.feedback().call()}})},Charcoal.Admin.Widget_Form.prototype.delete_object=function(a){var b=this;console.debug(a),BootstrapDialog.confirm({title:"Confirmer la suppression",type:BootstrapDialog.TYPE_DANGER,message:"Ãtes-vous sÃ»r de vouloir supprimer cet objet? Cette action est irrÃ©versible.",btnOKLabel:"Supprimer",btnCancelLabel:"Annuler",callback:function(a){if(a){var c=Charcoal.Admin.admin_url()+"object/delete",d={obj_type:b.obj_type,obj_id:b.obj_id};$.ajax({method:"POST",url:c,data:d}).done(function(a){if(console.debug(a),a.success){var c=Charcoal.Admin.admin_url()+"object/collection?obj_type="+b.obj_type;window.location.href=c}else window.alert("Erreur. Impossible de supprimer cet objet.")})}}})},Charcoal.Admin.Widget_Form.prototype.switch_language=function(a){$("[data-lang][data-lang!="+a+"]").addClass("hidden"),$("[data-lang][data-lang="+a+"]").removeClass("hidden"),$("[data-lang-switch][data-lang-switch!="+a+"]").removeClass("btn-primary"),$("[data-lang-switch][data-lang-switch="+a+"]").addClass("btn-primary")},Charcoal.Admin.Widget_Map=function(){return this._controller=void 0,this.widget_type="charcoal/admin/widget/map",this},Charcoal.Admin.Widget_Map.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Map.prototype.constructor=Charcoal.Admin.Widget_Map,Charcoal.Admin.Widget_Map.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Map.prototype.init=function(){var a=this;return"undefined"==typeof google?(window._tmp_google_onload_function=function(){a.activate_map()},$.getScript("https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&language=fr&callback=_tmp_google_onload_function",function(){})):a.activate_map(),this},Charcoal.Admin.Widget_Map.prototype.activate_map=function(){var a={strokeColor:"#000000",strokeOpacity:.8,strokeWeight:3,fillColor:"#ffffff",fillOpacity:.35,hover:{strokeColor:"#000000",strokeOpacity:1,strokeWeight:2,fillColor:"#ffffff",fillOpacity:.5},focused:{fillOpacity:.8}},b={default_styles:a,use_clusterer:!1,map:{center:{x:this.opts("coords")[0],y:this.opts("coords")[1]},zoom:14,mapType:"roadmap",coordsType:"inpage",map_mode:"default"},places:{first:{type:"marker",coords:this.coords()}}};this._controller=new window.BB.gmap.controller(this.element().find(".js-map-maker-map").get(0),b),this.controller().set_styles([{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]}]),this.controller().remove_focus(),this.controller().init()},Charcoal.Admin.Widget_Map.prototype.controller=function(){return this._controller},Charcoal.Admin.Widget_Map.prototype.coords=function(){return this.opts("coords")},Charcoal.Admin.Widget_Quick_Form=function(a){return this.widget_type="charcoal/admin/widget/quick-form",this.save_callback=a.save_callback||"",this},Charcoal.Admin.Widget_Quick_Form.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Quick_Form.prototype.constructor=Charcoal.Admin.Widget_Quick_Form,Charcoal.Admin.Widget_Quick_Form.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Quick_Form.prototype.init=function(){this.bind_events()},Charcoal.Admin.Widget_Quick_Form.prototype.bind_events=function(){var a=this;this.element().on("submit",function(b){b.preventDefault(),a.submit_form(this)})},Charcoal.Admin.Widget_Quick_Form.prototype.submit_form=function(a){Charcoal.Admin.manager().prepare_submit();var b,c,d=this,e=new FormData(a);d.obj_id?(b=Charcoal.Admin.admin_url()+"object/update",c=!1):(b=Charcoal.Admin.admin_url()+"object/save",c=!0),$.ajax({url:b,type:"POST",processData:!1,contentType:!1,data:e,success:function(a){a.success?(Charcoal.Admin.feedback().add_data(a.feedbacks),a.next_url&&Charcoal.Admin.feedback().add_action({label:"Continuer",callback:function(){window.location.href=Charcoal.Admin.admin_url()+a.next_url}}),"function"==typeof d.save_callback&&d.save_callback(a)):(Charcoal.Admin.feedback().add_data([{level:"An error occurred and the object could not be saved.",msg:"error"}]),Charcoal.Admin.feedback().call())},error:function(){Charcoal.Admin.feedback().add_data([{level:"An error occurred and the object could not be saved.",msg:"error"}]),Charcoal.Admin.feedback().call()}})},Charcoal.Admin.Widget_Search=function(a){return this._elem=void 0,a?"undefined"==typeof a.id?!1:(this.set_element($("#"+a.id)),"object"!=typeof a.data?!1:(this.opts=a,this)):!1},Charcoal.Admin.Widget_Search.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Search.prototype.constructor=Charcoal.Admin.Widget_Search,Charcoal.Admin.Widget_Search.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Search.prototype.set_remote_widget=function(){},Charcoal.Admin.Widget_Search.prototype.init=function(){var a=this.element(),b=this;a.on("click",".js-search",function(a){a.preventDefault(),b.submit()}),a.on("click",".js-undo",function(a){a.preventDefault(),b.undo()})},Charcoal.Admin.Widget_Search.prototype.submit=function(){for(var a=Charcoal.Admin.manager(),b=a.components.widgets,c=0,d=b.length;d>c;c++)this.dispatch(b[c]);return this},Charcoal.Admin.Widget_Search.prototype.undo=function(){return this.element().find("input").val(""),this.submit(),this},Charcoal.Admin.Widget_Search.prototype.dispatch=function(a){if(!a)return this;if("function"!=typeof a.add_filter)return this;"undefined"!=typeof a.pagination&&(a.pagination.page=1);for(var b=this.element().find("input"),c=b.val(),d=this.opts.data.list||[],e=0,f=d.length;f>e;e++){var g={};g[d[e]]={},g[d[e]].val="%"+c+"%",g[d[e]].property=d[e],g[d[e]].operator="LIKE",g[d[e]].operand="OR",a.add_filter(g)}return a.reload(),this},Charcoal.Admin.Widget_Table=function(){this.widget_type="charcoal/admin/widget/table",this.obj_type=null,this.widget_id=null,this.table_selector=null,this.properties_options=null,this.filters={},this.orders=[],this.pagination={page:1,num_per_page:50},this.table_rows=[]},Charcoal.Admin.Widget_Table.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Table.prototype.constructor=Charcoal.Admin.Widget_Table,Charcoal.Admin.Widget_Table.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Table.prototype.init=function(){this.set_properties().create_rows().bind_events()},Charcoal.Admin.Widget_Table.prototype.set_properties=function(){var a=this.opts();return this.obj_type=a.data.obj_type||this.obj_type,this.widget_id=a.id||this.widget_id,this.table_selector="#"+this.widget_id,this.properties=a.data.properties||this.properties,this.properties_options=a.data.properties_options||this.properties_options,this.filters=a.data.filters||this.filters,this.orders=a.data.orders||this.orders,this.pagination=a.data.pagination||this.pagination,this.collection_ident=a.data.collection_ident||"default",this},Charcoal.Admin.Widget_Table.prototype.create_rows=function(){for(var a=$(".js-table-row"),b=0,c=a.length;c>b;b++){var d=a[b],e=new Charcoal.Admin.Widget_Table.Table_Row(this,d);this.table_rows.push(e)}return this},Charcoal.Admin.Widget_Table.prototype.bind_events=function(){var a=this;$(".js-list-quick-create",a.table_selector).on("click",function(b){b.preventDefault();var c=Charcoal.Admin.admin_url()+"widget/load",d={widget_type:"charcoal/admin/widget/objectform",widget_options:{obj_type:a.obj_type,obj_id:0}};$.post(c,d,function(a){var b=BootstrapDialog.show({title:"Quick Create",message:"...",nl2br:!1});a.success?b.setMessage(a.widget_html):(b.setType(BootstrapDialog.TYPE_DANGER),b.setMessage("Error"))})}),$(".js-sublist-inline-edit").on("click",function(b){b.preventDefault();var c=a.sublist(),d=Charcoal.Admin.admin_url()+"widget/table/inlinemulti",e={obj_type:a.obj_type,obj_ids:c.obj_ids};$.post(d,e,function(a){if(a.success)for(var b=a.objects,d=0;d<=b.length-1;d++){window.console.debug(b[d]);var e=b[d].inline_properties,f=$(c.elems[d]).parents("tr"),g=0;for(g in e){var h=f.find(".property-"+g);h.html(e[g])}}})}),$(".js-list-import",a.element).on("click",function(b){b.preventDefault();var c=$(this),d=c.data("widget-type");console.debug(d),a.widget_dialog({title:"Importer une liste",widget_type:d,widget_options:{obj_type:a.obj_type,obj_id:0}})}),$("tbody.js-sortable").sortable({cursor:"ns-resize",delay:150,distance:5,opacity:.75,containment:"parent",placeholder:"ui-tablesort-placeholder",helper:function(a,b){return b.children().each(function(){$(this).width($(this).width())}),b},change:function(a,b){console.debug(a,b)},update:function(b,c){console.debug(b,c);var d=$(this).sortable("toArray",{attribute:"data-id"}),e={obj_type:a.obj_type,obj_orders:d,starting_order:1},f=Charcoal.Admin.admin_url()+"object/reorder";$.ajax({method:"POST",url:f,data:e}).done(function(a){console.debug(a)})}}).disableSelection(),$(".js-page-switch").on("click",function(b){b.preventDefault();var c=$(this),d=c.data("page-num");a.pagination.page=d,a.reload()})},Charcoal.Admin.Widget_Table.prototype.sublist=function(){var a=$(".select-row:checked"),b={elems:[],obj_ids:[]};return a.each(function(a,c){b.obj_ids.push($(c).parents("tr").data("id")),b.elems.push(c)}),b},Charcoal.Admin.Widget_Table.prototype.add_filter=function(a){var b=this.get_filters();return null===b&&(b={}),b=$.extend(b,a),this.set_filters(b),this},Charcoal.Admin.Widget_Table.prototype.set_filters=function(a){this.filters=a},Charcoal.Admin.Widget_Table.prototype.get_filters=function(){return this.filters},Charcoal.Admin.Widget_Table.prototype.widget_options=function(){return{obj_type:this.obj_type,collection_config:{properties:this.properties,properties_options:this.properties_options,filters:this.filters,orders:this.orders,pagination:this.pagination},collection_ident:this.collection_ident}},Charcoal.Admin.Widget_Table.prototype.reload=function(a){var b=function(b){"function"==typeof a&&a(b)};return Charcoal.Admin.Widget.prototype.reload.call(this,b),this},Charcoal.Admin.Widget_Table.prototype.widget_dialog=function(a){var b=a.title||"",c=a.type||BootstrapDialog.TYPE_PRIMARY,d=a.widget_type,e=a.widget_options||{};d&&BootstrapDialog.show({title:b,type:c,nl2br:!1,message:function(a){console.debug(a);var b=Charcoal.Admin.admin_url()+"widget/load",c={widget_type:d,widget_options:e},f=$("<div>Loading...</div>");return $.ajax({method:"POST",url:b,data:c}).done(function(b){console.debug(b),b.success?a.setMessage(b.widget_html):(a.setType(BootstrapDialog.TYPE_DANGER),a.setMessage("Error"))}),f}})},Charcoal.Admin.Widget_Table.Table_Row=function(a,b){this.widget_table=a,this.element=b,this.obj_id=this.element.getAttribute("data-id"),this.obj_type=this.widget_table.obj_type,this.load_url=Charcoal.Admin.admin_url()+"widget/load",this.inline_url=Charcoal.Admin.admin_url()+"widget/table/inline",this.delete_url=Charcoal.Admin.admin_url()+"object/delete",this.bind_events()},Charcoal.Admin.Widget_Table.Table_Row.prototype.bind_events=function(){var a=this;$(".js-obj-quick-edit",a.element).on("click",function(b){b.preventDefault(),a.quick_edit()}),$(".js-obj-inline-edit",a.element).on("click",function(b){b.preventDefault(),a.inline_edit()}),$(".js-obj-delete",a.element).on("click",function(b){b.preventDefault(),a.delete_object()})},Charcoal.Admin.Widget_Table.Table_Row.prototype.quick_edit=function(){var a={widget_type:"charcoal/admin/widget/objectForm",widget_options:{obj_type:this.obj_type,obj_id:this.obj_id}};$.post(this.load_url,a,function(a){var b=BootstrapDialog.show({title:"Quick Edit",message:"...",nl2br:!1});a.success?b.setMessage(a.widget_html):(b.setType(BootstrapDialog.TYPE_DANGER),b.setMessage("Error"))})},Charcoal.Admin.Widget_Table.Table_Row.prototype.inline_edit=function(){var a=this,b={obj_type:a.obj_type,obj_id:a.obj_id};$.post(a.inline_url,b,function(b){if(b.success){var c,d=b.inline_properties;for(c in d){var e=$(a.element).find(".property-"+c);e.html(d[c])}}})},Charcoal.Admin.Widget_Table.Table_Row.prototype.delete_object=function(){var a=this,b={obj_type:a.obj_type,obj_id:a.obj_id};window.confirm("Are you sure you want to delete this object?")&&$.post(a.delete_url,b,function(b){b.success?$(a.element).remove():window.alert("Delete failed.")})},Charcoal.Admin.Widget_Wysiwyg=function(){$(".js-wysiwyg").summernote({height:300})};